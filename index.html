
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Voiceflow Chat Landing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Welcome visitors with an accessible Voiceflow chat experience on a full-screen background."
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Voiceflow Chat Landing" />
    <meta
      property="og:description"
      content="Invite visitors to chat with Voiceflow on a performant, accessible landing page."
    />
    <meta property="og:image" content="assets/popup_bg.png" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Voiceflow Chat Landing" />
    <meta
      name="twitter:description"
      content="Invite visitors to chat with Voiceflow on a performant, accessible landing page."
    />
    <meta name="twitter:image" content="assets/popup_bg.png" />

    <link rel="icon" href="assets/favicon.ico" />
    <link rel="preload" href="assets/popup_bg.png" as="image" />
    <link rel="stylesheet" href="styles/main.css" />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to chat</a>

    <header class="site-header" role="banner">
      <h1 class="visually-hidden">Voiceflow Chat Landing</h1>
    </header>

    <main id="main-content" class="site-main" role="main" aria-label="Chat area">
      <div class="chat-shell" role="region" aria-label="Voiceflow chat">
        <p class="chat-shell__message">
          Tap the Voiceflow chat bubble in the corner to start the conversation.
        </p>
      </div>
      <a
        class="floating-link"
        href="https://example.com"
        target="_blank"
        rel="noreferrer"
        aria-label="Learn more about this assistant (opens in a new tab)"
      >
        <span class="floating-link__text">Company site</span>
        <img
          src="assets/arrow.svg"
          alt=""
          aria-hidden="true"
          class="floating-link__icon"
        />
      </a>
    </main>

    <footer class="site-footer" role="contentinfo">
      <p class="visually-hidden">Footer</p>
    </footer>



<script>

console.log('Config File: default.js - default client config file loaded');


  (function(d, t) {
      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
      v.onload = function() {
        window.voiceflow.chat.load({
          verify: { projectID: '68f9dca7b9abe8c36ec96e77' },
          url: 'https://general-runtime.voiceflow.com',
          versionID: 'production',
          assistant: {
            extensions: [] // your extension's name goes here
          },
          voice: {
            url: "https://runtime-api.voiceflow.com"
          }
        });
      }
      v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs"; v.type = "text/javascript"; s.parentNode.insertBefore(v, s);
  })(document, 'script');



//run other scripts here

const UPS_ANALYTICS_URL = 'https://upseller-analytics.vercel.app/api/events';
const UPS_EVENT_TOKEN = 'test_sandbox_write_token_123';
const VF_TEST_PROJECT_ID = '68f9dca7b9abe8c36ec96e77';
const VF_WIDGET_HOST_SELECTOR = '#voiceflow-chat';
const UPS_SESSION_ID =
  localStorage.getItem('ups_session_id') ||
  (() => {
    const id = crypto.randomUUID();
    localStorage.setItem('ups_session_id', id);
    return id;
  })();

async function sendWidgetEvent(eventName, props = {}) {
  try {
    console.log('[Upseller Analytics] Sending event:', eventName, props);
    await fetch(UPS_ANALYTICS_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${UPS_EVENT_TOKEN}`,
      },
      body: JSON.stringify({
        events: [
          {
            event_id: crypto.randomUUID(),
            event_name: eventName,
            session_id: UPS_SESSION_ID,
            occurred_at: new Date().toISOString(),
            project_id: VF_TEST_PROJECT_ID,
            properties: { page: window.location.pathname, ...props },
          },
        ],
      }),
    });
  } catch (error) {
    console.error('[Upseller Analytics] Failed to send', eventName, error);
  }
}

function trackWidgetSeenOnce() {
  if (window.__upsellerWidgetSeen) return;
  console.log('[Upseller Analytics] Widget seen detected');
  window.__upsellerWidgetSeen = true;
  sendWidgetEvent('widget_seen', { page: window.location.pathname });
}

function findVoiceflowWidget() {
  const host = document.querySelector(VF_WIDGET_HOST_SELECTOR);
  if (!host) {
    console.log('[Upseller Analytics] Widget host not found yet');
    return null;
  }

  if (host.shadowRoot) {
    return host.shadowRoot.querySelector('.vfrc-widget');
  }

  return host;
}

window.addEventListener('load', () => {
  const initialWidget = findVoiceflowWidget();
  if (initialWidget) {
    console.log('[Upseller Analytics] Widget already present on load');
    trackWidgetSeenOnce();
    return;
  }

  const observer = new MutationObserver(() => {
    const widgetEl = findVoiceflowWidget();

    if (widgetEl) {
      console.log('[Upseller Analytics] Widget detected via MutationObserver');
      trackWidgetSeenOnce();
      observer.disconnect();
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });
});


</script>

    <script type="module">
      // Inline feedback UI: compact icon-only thumbs on every agent message with optional comment tooltip.
      const SVG_THUMB = `<svg width="24px" height="24px" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.29398 20.4966C4.56534 20.4966 4 19.8827 4 19.1539V12.3847C4 11.6559 4.56534 11.042 5.29398 11.042H8.12364L10.8534 4.92738C10.9558 4.69809 11.1677 4.54023 11.4114 4.50434L11.5175 4.49658C12.3273 4.49658 13.0978 4.85402 13.6571 5.48039C14.2015 6.09009 14.5034 6.90649 14.5034 7.7535L14.5027 8.92295L18.1434 8.92346C18.6445 8.92346 19.1173 9.13931 19.4618 9.51188L19.5612 9.62829C19.8955 10.0523 20.0479 10.6054 19.9868 11.1531L19.1398 18.742C19.0297 19.7286 18.2529 20.4966 17.2964 20.4966H8.69422H5.29398ZM11.9545 6.02658L9.41727 11.7111L9.42149 11.7693L9.42091 19.042H17.2964C17.4587 19.042 17.6222 18.8982 17.6784 18.6701L17.6942 18.5807L18.5412 10.9918C18.5604 10.8194 18.5134 10.6486 18.4189 10.5287C18.3398 10.4284 18.2401 10.378 18.1434 10.378H13.7761C13.3745 10.378 13.0488 10.0524 13.0488 9.65073V7.7535C13.0488 7.2587 12.8749 6.78825 12.5721 6.44915C12.4281 6.28794 12.2615 6.16343 12.0824 6.07923L11.9545 6.02658ZM7.96636 12.4966H5.45455V19.042H7.96636V12.4966Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M5.29398 20.4966C4.56534 20.4966 4 19.8827 4 19.1539V12.3847C4 11.6559 4.56534 11.042 5.29398 11.042H8.12364L10.8534 4.92738C10.9558 4.69809 11.1677 4.54023 11.4114 4.50434L11.5175 4.49658C12.3273 4.49658 13.0978 4.85402 13.6571 5.48039C14.2015 6.09009 14.5034 6.90649 14.5034 7.7535L14.5027 8.92295L18.1434 8.92346C18.6445 8.92346 19.1173 9.13931 19.4618 9.51188L19.5612 9.62829C19.8955 10.0523 20.0479 10.6054 19.9868 11.1531L19.1398 18.742C19.0297 19.7286 18.2529 20.4966 17.2964 20.4966H8.69422H5.29398ZM11.9545 6.02658L9.41727 11.7111L9.42149 11.7693L9.42091 19.042H17.2964C17.4587 19.042 17.6222 18.8982 17.6784 18.6701L17.6942 18.5807L18.5412 10.9918C18.5604 10.8194 18.5134 10.6486 18.4189 10.5287C18.3398 10.4284 18.2401 10.378 18.1434 10.378H13.7761C13.3745 10.378 13.0488 10.0524 13.0488 9.65073V7.7535C13.0488 7.2587 12.8749 6.78825 12.5721 6.44915C12.4281 6.28794 12.2615 6.16343 12.0824 6.07923L11.9545 6.02658ZM7.96636 12.4966H5.45455V19.042H7.96636V12.4966Z" fill="currentColor"></path></svg>`;
      const FEEDBACK_CONTAINER_CLASS = "vfrc-feedback-container";
      const FEEDBACK_ATTR = "data-vf-feedback-ready";
      const TOOLTIP_OPEN_CLASS = "vf-fb-tooltip--open";
      const STYLES_ID = "vf-feedback-styles";
      const INJECTION_DELAY_MS = 250;

      const thumbUpSVG = SVG_THUMB.replace(
        'fill="currentColor"',
        'fill="rgba(33, 69, 33, 0.7)"'
      );
      const thumbDownSVG = SVG_THUMB.replace(
        'fill="currentColor"',
        'fill="rgba(105, 22, 22, 0.7)"'
      );

      const getChatShadowRoot = () => document.querySelector("#voiceflow-chat")?.shadowRoot;
      const getComposerTop = (shadow) =>
        shadow?.querySelector(".vfrc-input-container")?.getBoundingClientRect().top ??
        window.innerHeight;

      const ensureFeedbackStyles = (shadowRoot) => {
        if (!shadowRoot || shadowRoot.getElementById(STYLES_ID)) return;
        const style = document.createElement("style");
        style.id = STYLES_ID;
        style.textContent = `
          .${FEEDBACK_CONTAINER_CLASS} {
            margin-top: 4px;
            display: inline-flex;
            gap: 6px;
            align-items: center;
            position: relative;
            color: inherit;
          }
          .${FEEDBACK_CONTAINER_CLASS}.vf-fb-complete {
            opacity: 0.85;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-buttons {
            display: inline-flex;
            gap: 6px;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.12);
            background: rgba(255,255,255,0.92);
            cursor: pointer;
            padding: 4px;
            transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button:hover {
            background: #f5f7f8;
            transform: translateY(-1px);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button.selected[data-feedback="1"] {
            background: #e8f5e9;
            border-color: rgba(46,125,50,0.28);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button.selected[data-feedback="0"] {
            background: #fdecea;
            border-color: rgba(211,47,47,0.28);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button:disabled {
            cursor: default;
            opacity: 0.7;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button svg {
            width: 16px;
            height: 16px;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-button[data-feedback="0"] svg {
            transform: rotate(180deg);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip {
            display: none;
            position: absolute;
            top: 34px;
            left: 0;
            z-index: 50;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip.${TOOLTIP_OPEN_CLASS} {
            display: block;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip.vf-fb-tooltip--flip {
            top: auto;
            bottom: 34px;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__bubble {
            position: relative;
            min-width: 200px;
            background: #0f2d32;
            color: #f2f6f7;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 10px 26px rgba(0,0,0,0.16);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__bubble::before {
            content: "";
            position: absolute;
            top: -6px;
            left: 12px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid #0f2d32;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip.vf-fb-tooltip--flip .vf-fb-tooltip__bubble::before {
            top: auto;
            bottom: -6px;
            border-bottom: none;
            border-top: 6px solid #0f2d32;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__label {
            font-size: 0.85rem;
            font-weight: 600;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip textarea {
            width: 100%;
            min-height: 54px;
            margin-top: 6px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.08);
            color: inherit;
            padding: 8px;
            resize: vertical;
            font-family: inherit;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip textarea::placeholder {
            color: rgba(255,255,255,0.7);
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__actions {
            margin-top: 8px;
            display: flex;
            gap: 6px;
            justify-content: flex-end;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__actions button {
            border-radius: 7px;
            border: 1px solid rgba(255,255,255,0.24);
            background: rgba(255,255,255,0.1);
            color: #f2f6f7;
            padding: 6px 10px;
            cursor: pointer;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__actions .vf-fb-submit {
            background: #48c6ea;
            color: #0b2930;
            border-color: transparent;
            font-weight: 600;
          }
          .${FEEDBACK_CONTAINER_CLASS} .vf-fb-tooltip__actions button:hover {
            filter: brightness(1.05);
          }
        `;
        shadowRoot.appendChild(style);
      };

      const insertAfter = (target, node) => {
        const parent = target?.parentNode;
        if (!parent) return;
        parent.insertBefore(node, target.nextSibling);
      };

      const getMessageText = (messageElement) => {
        const target =
          messageElement?.querySelector(
            ".vfrc-message__text, .vfrc-assistant-message, .vfrc-system-message"
          ) || messageElement;
        return (target?.innerText || "").trim().replace(/\s+/g, " ");
      };

      const buildFeedbackContainer = (messageElement) => {
        const container = document.createElement("div");
        container.className = FEEDBACK_CONTAINER_CLASS;
        container.innerHTML = `
          <div class="vf-fb-buttons">
            <button class="vf-fb-button" data-feedback="1" aria-label="thumbs up">${thumbUpSVG}</button>
            <button class="vf-fb-button" data-feedback="0" aria-label="thumbs down">${thumbDownSVG}</button>
          </div>
          <div class="vf-fb-tooltip">
            <div class="vf-fb-tooltip__bubble">
              <div class="vf-fb-tooltip__label">Add a quick note?</div>
              <textarea placeholder="Optional comment..." aria-label="Feedback comment"></textarea>
              <div class="vf-fb-tooltip__actions">
                <button type="button" class="vf-fb-skip">Skip</button>
                <button type="button" class="vf-fb-submit">Send</button>
              </div>
            </div>
          </div>
        `;

        const buttons = container.querySelectorAll(".vf-fb-button");
        const tooltip = container.querySelector(".vf-fb-tooltip");
        const textarea = container.querySelector("textarea");
        const submitBtn = container.querySelector(".vf-fb-submit");
        const skipBtn = container.querySelector(".vf-fb-skip");

        let currentRating = null;
        let locked = false;

        const openTooltip = () => {
          tooltip.classList.remove("vf-fb-tooltip--flip");
          tooltip.classList.add(TOOLTIP_OPEN_CLASS);
          const shadow = getChatShadowRoot();
          const containerRect = container.getBoundingClientRect();
          const tooltipRect = tooltip.getBoundingClientRect();
          const composerTop = getComposerTop(shadow);
          const spaceBelow = composerTop - containerRect.bottom;
          if (spaceBelow < tooltipRect.height + 12) {
            tooltip.classList.add("vf-fb-tooltip--flip");
          }
          textarea.focus();
        };

        const closeTooltip = () => tooltip.classList.remove(TOOLTIP_OPEN_CLASS, "vf-fb-tooltip--flip");

        const finalizeFeedback = (commentText = "") => {
          if (!currentRating || locked) return;
          locked = true;
          const payload = {
            rating: currentRating,
            prompt: getMessageText(messageElement),
          };
          if (commentText) payload.comment = commentText;
          sendWidgetEvent("feedback_submitted", payload);
          buttons.forEach((b) => (b.disabled = true));
          container.classList.add("vf-fb-complete");
          closeTooltip();
        };

        buttons.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (locked) return;
            currentRating = btn.getAttribute("data-feedback") === "1" ? "up" : "down";
            buttons.forEach((b) => b.classList.toggle("selected", b === btn));
            openTooltip();
          });
        });

        submitBtn.addEventListener("click", () => finalizeFeedback(textarea.value.trim()));
        skipBtn.addEventListener("click", () => finalizeFeedback(""));
        textarea.addEventListener("keydown", (event) => {
          if (event.key === "Escape") {
            closeTooltip();
          }
          if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault();
            finalizeFeedback(textarea.value.trim());
          }
        });

        return container;
      };

      const decorateMessage = (messageElement) => {
        if (!messageElement || messageElement.hasAttribute(FEEDBACK_ATTR)) return;
        if (messageElement.closest(".vfrc-user-response")) return; // only show on agent/system messages
        const container = buildFeedbackContainer(messageElement);
        insertAfter(messageElement, container);
        messageElement.setAttribute(FEEDBACK_ATTR, "true");
      };

      const scanMessages = () => {
        const shadow = getChatShadowRoot();
        if (!shadow) return;
        ensureFeedbackStyles(shadow);
        shadow.querySelectorAll(".vfrc-message").forEach(decorateMessage);
      };

      const startObserver = () => {
        const shadow = getChatShadowRoot();
        if (!shadow) return;
        const list = shadow.querySelector(".vfrc-message-list") || shadow;
        const observer = new MutationObserver(() => {
          scanMessages();
        });
        observer.observe(list, { childList: true, subtree: true });
      };

      const bootFeedback = () => {
        const shadow = getChatShadowRoot();
        if (!shadow) {
          setTimeout(bootFeedback, INJECTION_DELAY_MS);
          return;
        }
        scanMessages();
        startObserver();

        window.addEventListener(
          "message",
          (event) => {
            if (!event.data || typeof event.data !== "string") return;
            let payload;
            try {
              payload = JSON.parse(event.data);
            } catch {
              return;
            }
            if (payload.type !== "voiceflow:interact") return;
            setTimeout(scanMessages, INJECTION_DELAY_MS);
          },
          false
        );
      };

      bootFeedback();
    </script>

  </body>
</html>
