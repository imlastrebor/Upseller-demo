
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Voiceflow Chat Landing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Welcome visitors with an accessible Voiceflow chat experience on a full-screen background."
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Voiceflow Chat Landing" />
    <meta
      property="og:description"
      content="Invite visitors to chat with Voiceflow on a performant, accessible landing page."
    />
    <meta property="og:image" content="assets/popup_bg.png" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Voiceflow Chat Landing" />
    <meta
      name="twitter:description"
      content="Invite visitors to chat with Voiceflow on a performant, accessible landing page."
    />
    <meta name="twitter:image" content="assets/popup_bg.png" />

    <link rel="icon" href="assets/favicon.ico" />
    <link rel="preload" href="assets/popup_bg.png" as="image" />
    <link rel="stylesheet" href="styles/main.css" />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to chat</a>

    <header class="site-header" role="banner">
      <h1 class="visually-hidden">Voiceflow Chat Landing</h1>
    </header>

    <main id="main-content" class="site-main" role="main" aria-label="Chat area">
      <div class="chat-shell" role="region" aria-label="Voiceflow chat">
        <p class="chat-shell__message">
          Tap the Voiceflow chat bubble in the corner to start the conversation.
        </p>
      </div>
      <a
        class="floating-link"
        href="https://example.com"
        target="_blank"
        rel="noreferrer"
        aria-label="Learn more about this assistant (opens in a new tab)"
      >
        <span class="floating-link__text">Company site</span>
        <img
          src="assets/arrow.svg"
          alt=""
          aria-hidden="true"
          class="floating-link__icon"
        />
      </a>
    </main>

    <footer class="site-footer" role="contentinfo">
      <p class="visually-hidden">Footer</p>
    </footer>

    <script type="text/javascript">
      (function () {
        const EVENT_ENDPOINT = "https://upseller-analytics.vercel.app/api/events";
        const EVENT_TOKEN = "test_sandbox_write_token_123";
        const PROJECT_ID = "68f9dca7b9abe8c36ec96e77";

        async function sendCustomEvent(eventName, props = {}) {
          if (!eventName) {
            console.warn("Missing event name for custom analytics event.");
            return;
          }

          try {
            await fetch(EVENT_ENDPOINT, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${EVENT_TOKEN}`,
              },
              body: JSON.stringify({
                events: [
                  {
                    event_id: (crypto && crypto.randomUUID
                      ? crypto.randomUUID()
                      : String(Date.now())),
                    event_name: eventName,
                    occurred_at: new Date().toISOString(),
                    project_id: PROJECT_ID,
                    properties: props,
                  },
                ],
              }),
            });
          } catch (error) {
            console.error("Failed to send event", eventName, error);
          }
        }

        window.sendCustomEvent = sendCustomEvent;
        window.__vfWidgetSeenSent = false;
      })();
    </script>

    <script type="text/javascript">
      (function (d, t) {
        var v = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
        v.onload = function () {
          function emitWidgetSeen() {
            if (window.__vfWidgetSeenSent || typeof window.sendCustomEvent !== "function") {
              return;
            }
            window.__vfWidgetSeenSent = true;
            window.sendCustomEvent("widget_seen", {
              page: window.location.pathname,
            });
          }

          window.addEventListener("VF_CHAT_READY", emitWidgetSeen, {
            once: true,
          });

          const observer = new MutationObserver(function (_, obs) {
            const widget = document.querySelector(
              "#voiceflow-chat, [data-testid='vf-chat-widget'], .vf-chat"
            );
            if (widget) {
              emitWidgetSeen();
              obs.disconnect();
            }
          });

          observer.observe(document.body, {
            childList: true,
            subtree: true,
          });

          window.voiceflow.chat.load({
            verify: { projectID: "68f9dca7b9abe8c36ec96e77" },
            url: "https://general-runtime.voiceflow.com",
            versionID: "production",
            voice: {
              url: "https://runtime-api.voiceflow.com",
            },
          });
        };
        v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs";
        v.type = "text/javascript";
        s.parentNode.insertBefore(v, s);
      })(document, "script");
    </script>
  </body>
</html>
