
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Voiceflow Chat Landing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Welcome visitors with an accessible Voiceflow chat experience on a full-screen background."
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Voiceflow Chat Landing" />
    <meta
      property="og:description"
      content="Invite visitors to chat with Voiceflow on a performant, accessible landing page."
    />
    <meta property="og:image" content="assets/popup_bg.png" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Voiceflow Chat Landing" />
    <meta
      name="twitter:description"
      content="Invite visitors to chat with Voiceflow on a performant, accessible landing page."
    />
    <meta name="twitter:image" content="assets/popup_bg.png" />

    <link rel="icon" href="assets/favicon.ico" />
    <link rel="preload" href="assets/popup_bg.png" as="image" />
    <link rel="stylesheet" href="styles/main.css" />
  </head>
  <body>
    <a class="skip-link" href="#main-content">Skip to chat</a>

    <header class="site-header" role="banner">
      <h1 class="visually-hidden">Voiceflow Chat Landing</h1>
    </header>

    <main id="main-content" class="site-main" role="main" aria-label="Chat area">
      <div class="chat-shell" role="region" aria-label="Voiceflow chat">
        <p class="chat-shell__message">
          Tap the Voiceflow chat bubble in the corner to start the conversation.
        </p>
      </div>
      <a
        class="floating-link"
        href="https://example.com"
        target="_blank"
        rel="noreferrer"
        aria-label="Learn more about this assistant (opens in a new tab)"
      >
        <span class="floating-link__text">Company site</span>
        <img
          src="assets/arrow.svg"
          alt=""
          aria-hidden="true"
          class="floating-link__icon"
        />
      </a>
    </main>

    <footer class="site-footer" role="contentinfo">
      <p class="visually-hidden">Footer</p>
    </footer>



<script>

console.log('Config File: default.js - default client config file loaded');


  (function(d, t) {
      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
      v.onload = function() {
        window.voiceflow.chat.load({
          verify: { projectID: '68f9dca7b9abe8c36ec96e77' },
          url: 'https://general-runtime.voiceflow.com',
          versionID: 'production',
          assistant: {
            extensions: [] // your extension's name goes here
          },
          voice: {
            url: "https://runtime-api.voiceflow.com"
          }
        });
      }
      v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs"; v.type = "text/javascript"; s.parentNode.insertBefore(v, s);
  })(document, 'script');



//run other scripts here

const UPS_ANALYTICS_URL = 'https://upseller-analytics.vercel.app/api/events';
const UPS_EVENT_TOKEN = 'test_sandbox_write_token_123';
const VF_TEST_PROJECT_ID = '68f9dca7b9abe8c36ec96e77';
const VF_WIDGET_HOST_SELECTOR = '#voiceflow-chat';

async function sendWidgetEvent(eventName, props = {}) {
  try {
    console.log('[Upseller Analytics] Sending event:', eventName, props);
    await fetch(UPS_ANALYTICS_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${UPS_EVENT_TOKEN}`,
      },
      body: JSON.stringify({
        events: [
          {
            event_id: crypto.randomUUID(),
            event_name: eventName,
            occurred_at: new Date().toISOString(),
            project_id: VF_TEST_PROJECT_ID,
            properties: props,
          },
        ],
      }),
    });
  } catch (error) {
    console.error('[Upseller Analytics] Failed to send', eventName, error);
  }
}

function trackWidgetSeenOnce() {
  if (window.__upsellerWidgetSeen) return;
  console.log('[Upseller Analytics] Widget seen detected');
  window.__upsellerWidgetSeen = true;
  sendWidgetEvent('widget_seen', { page: window.location.pathname });
}

function findVoiceflowWidget() {
  const host = document.querySelector(VF_WIDGET_HOST_SELECTOR);
  if (!host) {
    console.log('[Upseller Analytics] Widget host not found yet');
    return null;
  }

  if (host.shadowRoot) {
    return host.shadowRoot.querySelector('.vfrc-widget');
  }

  return host;
}

window.addEventListener('load', () => {
  const initialWidget = findVoiceflowWidget();
  if (initialWidget) {
    console.log('[Upseller Analytics] Widget already present on load');
    trackWidgetSeenOnce();
    return;
  }

  const observer = new MutationObserver(() => {
    const widgetEl = findVoiceflowWidget();

    if (widgetEl) {
      console.log('[Upseller Analytics] Widget detected via MutationObserver');
      trackWidgetSeenOnce();
      observer.disconnect();
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });
});


</script>

  </body>
</html>
